<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether Atlas | Global Registry</title>
    
    <!-- Core Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
    <script src="L.Terminator.js" defer></script>
    
    <!-- Aetheric Interface Design System -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="auth.css" />
    
    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="dark-theme"> 
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1 class="brand-title">Aether Atlas</h1>
            </div>

            <!-- User Authentication Section -->
            <div id="auth-section" class="card">
                <!-- This will be dynamically populated by app.js -->
            </div>

            <!-- Controls -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Base Layer</h2>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <select id="tile-layer-select" class="form-control">
                            <option value="dark">Dark</option>
                            <option value="satellite">Satellite</option>
                            <option value="street">Street</option>
                            <option value="terrain">Terrain</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="add-report-section" class="card" style="display:none;">
                <div class="card-header">
                    <h2 class="card-title">Field Reports</h2>
                </div>
                <div class="card-body">
                    <p class="text-secondary mb-2">Submit a new finding for Guild review.</p>
                    <button id="open-report-modal-btn" class="btn btn-primary" style="width: 100%;">
                        <i data-feather="plus-circle" style="vertical-align: middle; margin-right: 4px;"></i> 
                        New Field Report
                    </button>
                </div>
            </div>

            <!-- Tools & Settings -->
             <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Tools & Settings</h2>
                </div>
                <div class="card-body">
                    <button id="theme-switcher" class="btn btn-secondary" style="width: 100%;">Switch Theme</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div id="map"></div>
        </main>
    </div>

    <!-- Field Report Modal -->
    <div id="report-modal" class="auth-modal">
        <div class="auth-modal-content" style="max-width: 600px;">
            <button class="auth-modal-close" id="report-modal-close">&times;</button>
            <form id="report-form">
                <h2 class="text-center mb-2">Submit Field Report</h2>
                
                <div class="grid-2-col" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="report-title" class="form-label">Report Title</label>
                        <input type="text" id="report-title" class="form-control" required placeholder="e.g. Whispering Woods Anomaly">
                    </div>
                    <div class="form-group">
                        <label for="report-threat" class="form-label">Threat Classification</label>
                        <select id="report-threat" class="form-control">
                            <option value="#00ff00">Low (Green)</option>
                            <option value="#ffff00">Medium (Yellow)</option>
                            <option value="#ff8800">High (Orange)</option>
                            <option value="#ff0000">Critical (Red)</option>
                            <option value="#aa00ff">Paranormal (Purple)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Location (Click on map to set)</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="report-lat" class="form-control" placeholder="Latitude" readonly required>
                        <input type="text" id="report-lng" class="form-control" placeholder="Longitude" readonly required>
                        <button type="button" id="set-location-btn" class="btn btn-secondary">Set</button>
                    </div>
                </div>

                <div class="card" style="padding: 12px; margin-bottom: 16px; background: rgba(0,0,0,0.1);">
                    <h4 class="mt-0 mb-1" style="font-size: 14px; text-transform: uppercase; color: var(--theme-text-secondary);">Environmental Readings</h4>
                    <div class="grid-2-col" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="env-emf" class="form-label">EMF (mG)</label>
                            <input type="number" step="0.1" id="env-emf" class="form-control" placeholder="0.0">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="env-temp" class="form-label">Temp (Â°C)</label>
                            <input type="number" step="0.1" id="env-temp" class="form-control" placeholder="20.0">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="env-sound" class="form-label">Sound (dB)</label>
                            <input type="number" id="env-sound" class="form-control" placeholder="0">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="report-details" class="form-label">Observations & Details</label>
                    <textarea id="report-details" class="form-control" rows="4" placeholder="Describe the phenomena..." required></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Report</button>
            </form>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- App Logic -->
    <script src="firebase-config.js"></script> <!-- IMPORTANT: Load config first -->
    <script src="auth.js"></script>
    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            feather.replace();
        });
    </script>
</body>
</html>
