<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aether Guild | Global Atlas & Research Archive</title>
    
    <!-- MapLibre GL JS -->
    <link href='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css' rel='stylesheet' />
    <script src='https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js'></script>
    
    <!-- Aetheric Interface Design System -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="auth.css" />
    
    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="dark-theme"> 

    <div class="app-container">
        <!-- Unified Sidebar -->
        <aside class="sidebar">
            <div style="text-align: center; padding-bottom: 16px; border-bottom: 1px solid var(--theme-border-color);">
                <h1 class="card-title" style="font-size: 24px;">Aether Guild</h1>
                <p class="text-secondary" style="font-size: 14px;">Global Atlas & Archive</p>
            </div>

            <div class="card">
                <div class="card-header"><h2 class="card-title">View</h2></div>
                <div class="card-body">
                    <button id="view-switch-atlas" class="btn btn-primary" style="width:100%">Atlas</button>
                    <button id="view-switch-wiki" class="btn btn-secondary mt-1" style="width:100%">Aetherpedia</button>
                </div>
            </div>

            <div id="auth-section" class="card"></div>
            <div id="add-report-section" class="card" style="display:none;"></div>

            <div class="card">
                <div class="card-header"><h2 class="card-title">Settings</h2></div>
                <div class="card-body">
                    <button id="theme-switcher" class="btn btn-secondary" style="width: 100%;">Switch Theme</button>
                </div>
            </div>
        </aside>

        <!-- Main View Area -->
        <main class="main-view">
            <header class="main-header">
                <div class="search-container">
                    <i data-feather="search" class="search-icon"></i>
                    <input type="search" id="search-input" placeholder="Search Aetherpedia & Wikipedia..." autocomplete="off">
                    <div id="search-results-container" style="display: none;"></div>
                </div>
            </header>

            <div class="content-area">
                <div id="map-container">
                    <!-- Layer Control Tree (Custom UI) -->
                    <div id="layer-tree-control" class="map-overlay-panel" style="display:none;">
                        <h4 class="overlay-title">Atlas Layers</h4>
                        
                        <div class="layer-group">
                            <h5 class="layer-group-title">Base Spectrum</h5>
                            <label class="layer-option"><input type="radio" name="basemap" value="dark" checked> Clinical Dark</label>
                            <label class="layer-option"><input type="radio" name="basemap" value="satellite"> Satellite Scan</label>
                            <label class="layer-option"><input type="radio" name="basemap" value="light"> Light Mode</label>
                        </div>

                        <div class="layer-group">
                            <h5 class="layer-group-title">Infrastructure</h5>
                            <label class="layer-option"><input type="checkbox" id="layer-power"> Power Grid (EMF)</label>
                            <label class="layer-option"><input type="checkbox" id="layer-rail"> Rail Network</label>
                            <label class="layer-option"><input type="checkbox" id="layer-telecom"> Telecom/Radio</label>
                        </div>

                        <div class="layer-group">
                            <h5 class="layer-group-title">Features</h5>
                            <label class="layer-option"><input type="checkbox" id="layer-labels" checked> Place Labels</label>
                            <label class="layer-option"><input type="checkbox" id="layer-borders" checked> Admin Borders</label>
                            <label class="layer-option"><input type="checkbox" id="layer-roads"> Highways & Paths</label>
                        </div>
                    </div>

                    <!-- Map HUD Overlay -->
                    <div id="map-hud">
                        <button id="toggle-layers-btn" class="map-tool-btn" title="Layers">
                            <i data-feather="layers"></i>
                        </button>
                        <div id="coord-display">LAT: --.---- LON: --.----</div>
                        <button id="locate-btn" class="map-tool-btn" title="Center on My Location">
                            <i data-feather="crosshair"></i>
                        </button>
                    </div>
                    
                    <!-- Zoom Slider -->
                    <div id="zoom-control-container">
                        <button id="zoom-in" class="zoom-btn">+</button>
                        <input type="range" id="zoom-slider" min="0" max="20" step="0.1" value="2">
                        <button id="zoom-out" class="zoom-btn">-</button>
                    </div>
                    
                    <!-- Dynamic Legend -->
                    <div id="dynamic-legend" class="map-overlay-panel legend-panel" style="display:none;">
                        <h4 class="overlay-title">Legend</h4>
                        <div id="legend-content"></div>
                    </div>

                </div>
                <div id="wiki-container" class="hidden">
                    <div id="wiki-content"></div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Field Report Modal -->
    <div id="report-modal" class="auth-modal">
        <div class="auth-modal-content" style="max-width: 600px;">
            <button class="auth-modal-close" id="report-modal-close">&times;</button>
            <form id="report-form">
                <h2 class="text-center mb-2">Submit Field Report</h2>
                
                <div class="grid-2-col" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div class="form-group">
                        <label for="report-title" class="form-label">Report Title</label>
                        <input type="text" id="report-title" class="form-control" required placeholder="e.g. Whispering Woods Anomaly">
                    </div>
                    <div class="form-group">
                        <label for="report-threat" class="form-label">Threat Classification</label>
                        <select id="report-threat" class="form-control">
                            <option value="#00ff00">Low (Green)</option>
                            <option value="#ffff00">Medium (Yellow)</option>
                            <option value="#ff8800">High (Orange)</option>
                            <option value="#ff0000">Critical (Red)</option>
                            <option value="#aa00ff">Paranormal (Purple)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Location (Click on map to set)</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="report-lat" class="form-control" placeholder="Latitude" readonly required>
                        <input type="text" id="report-lng" class="form-control" placeholder="Longitude" readonly required>
                        <button type="button" id="set-location-btn" class="btn btn-secondary">Set</button>
                    </div>
                </div>

                <div class="card" style="padding: 12px; margin-bottom: 16px; background: rgba(0,0,0,0.1);">
                    <h4 class="mt-0 mb-1" style="font-size: 14px; text-transform: uppercase; color: var(--theme-text-secondary);">Environmental Readings</h4>
                    <div class="grid-2-col" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="env-emf" class="form-label">EMF (mG)</label>
                            <input type="number" step="0.1" id="env-emf" class="form-control" placeholder="0.0">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="env-temp" class="form-label">Temp (Â°C)</label>
                            <input type="number" step="0.1" id="env-temp" class="form-control" placeholder="20.0">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label for="env-sound" class="form-label">Sound (dB)</label>
                            <input type="number" id="env-sound" class="form-control" placeholder="0">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="report-details" class="form-label">Observations & Details</label>
                    <textarea id="report-details" class="form-control" rows="4" placeholder="Describe the phenomena..." required></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">Submit Report</button>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <!-- App Logic -->
    <script src="firebase-config.js" defer></script>
    <script src="auth.js" defer></script>
    <script src="aetherpedia.js" defer></script>
    <script src="app.js" defer></script>

</body>
</html>
